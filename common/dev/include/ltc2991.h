/*
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

#ifndef LTC2991_H
#define LTC2991_H

#define LTC2991_DATA_SIGN_BIT BIT(6)
#define LTC2991_DATA_VALID_BIT BIT(7)
#define LTC2991_ENABLE_CHANNEL_V1_V2 BIT(4)
#define LTC2991_ENABLE_CHANNEL_V3_V4 BIT(5)
#define LTC2991_ENABLE_CHANNEL_V5_V6 BIT(6)
#define LTC2991_ENABLE_CHANNEL_V7_V8 BIT(7)

#define LTC2991_READ_VOLTAGE 0
#define LTC2991_READ_TEMPERATURE BIT(3)
#define LTC2991_KEEP_DEFAULT_SETTING -1
#define LTC2991_DATA_NOT_READY_DELAY_MS 10
#define LTC2991_VOLTAGE_LSB 0.00030517578125
#define LTC2991_TEMPERATURE_LSB 0.0625

enum LTC2991_VOLTAGE_CHANNEL {
	LTC2991_VOLTAGE_CHANNEL_1,
	LTC2991_VOLTAGE_CHANNEL_2,
	LTC2991_VOLTAGE_CHANNEL_3,
	LTC2991_VOLTAGE_CHANNEL_4,
	LTC2991_VOLTAGE_CHANNEL_5,
	LTC2991_VOLTAGE_CHANNEL_6,
	LTC2991_VOLTAGE_CHANNEL_7,
	LTC2991_VOLTAGE_CHANNEL_8,
};

enum LTC2991_READ_OPTIONAL {
	/* Use bit3 to indicate the read type */
	LTC2991_READ_V1_VOLTAGE = (LTC2991_READ_VOLTAGE | LTC2991_VOLTAGE_CHANNEL_1),
	LTC2991_READ_V2_VOLTAGE,
	LTC2991_READ_V3_VOLTAGE,
	LTC2991_READ_V4_VOLTAGE,
	LTC2991_READ_V5_VOLTAGE,
	LTC2991_READ_V6_VOLTAGE,
	LTC2991_READ_V7_VOLTAGE,
	LTC2991_READ_V8_VOLTAGE,
	LTC2991_READ_V1_V2_TEMPERATURE = (LTC2991_READ_TEMPERATURE | LTC2991_VOLTAGE_CHANNEL_1),
	LTC2991_READ_V3_V4_TEMPERATURE = (LTC2991_READ_TEMPERATURE | LTC2991_VOLTAGE_CHANNEL_3),
	LTC2991_READ_V5_V6_TEMPERATURE = (LTC2991_READ_TEMPERATURE | LTC2991_VOLTAGE_CHANNEL_5),
	LTC2991_READ_V7_V8_TEMPERATURE = (LTC2991_READ_TEMPERATURE | LTC2991_VOLTAGE_CHANNEL_7),
};

enum LTC2991_REGISTER {
	LTC2991_ENABLE_CHANNEL_REG = 0x01,
	LTC2991_V1_V4_CONTROL_REG = 0x06,
	LTC2991_V5_V8_CONTROL_REG,
	LTC2991_VCC_TEMP_CONTROL_REG,
	LTC2991_V1_MSB_REG = 0x0A,
	LTC2991_V1_LSB_REG,
	LTC2991_V2_MSB_REG,
	LTC2991_V2_LSB_REG,
	LTC2991_V3_MSB_REG,
	LTC2991_V3_LSB_REG,
	LTC2991_V4_MSB_REG,
	LTC2991_V4_LSB_REG,
	LTC2991_V5_MSB_REG,
	LTC2991_V5_LSB_REG,
	LTC2991_V6_MSB_REG,
	LTC2991_V6_LSB_REG,
	LTC2991_V7_MSB_REG,
	LTC2991_V7_LSB_REG,
	LTC2991_V8_MSB_REG,
	LTC2991_V8_LSB_REG,
};

int ltc2991_read_optional_to_register(uint8_t read_optional, uint8_t *msb_register,
				      uint8_t *lsb_register, float *parameter, uint8_t *channel);

#endif
